name: CI

on:
 push:
  branches: [ master ]
  paths:
   - '!**.md'
 pull_request:
  branches: [ master ]
  paths:
   - '!**.md'

jobs:
 test_latest:
  runs-on: ubuntu-latest

  steps:
   - name: Checkout
     uses: actions/checkout@v2

   - name: Validate composer.json
     run: composer validate

   - name: Get Composer Cache Directory
     id: composer-cache
     run: echo "::set-output name=dir::$(composer config cache-files-dir)"
   - name: Setup cache
     uses: actions/cache@v2
     with:
      path: ${{ steps.composer-cache.outputs.dir }}
      key: ${{ runner.os }}-composer-latest
      restore-keys: ${{ runner.os }}-composer-latest

   - name: Install dependencies
     if: steps.composer-cache.outputs.cache-hit != 'true'
     run: composer update --prefer-dist --no-ansi --no-interaction --no-progress

   - name: Run CI tools
     run: composer ci-all

 test_lowest:
  runs-on: ubuntu-latest

  steps:
   - name: Checkout
     uses: actions/checkout@v2

   - name: Validate composer.json
     run: composer validate

   - name: Get Composer Cache Directory
     id: composer-cache
     run: echo "::set-output name=dir::$(composer config cache-files-dir)"
   - name: Setup cache
     uses: actions/cache@v2
     with:
      path: ${{ steps.composer-cache.outputs.dir }}
      key: ${{ runner.os }}-composer-lowest
      restore-keys: ${{ runner.os }}-composer-lowest

   - name: Install dependencies
     if: steps.composer-cache.outputs.cache-hit != 'true'
     run: composer update --prefer-dist --no-ansi --no-interaction --no-progress --prefer-lowest

   - name: Run CI tools
     run: composer ci-all
